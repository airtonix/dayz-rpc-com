version: '3.8'

services:
  dayz-server:
    image: ubuntu:20.04
    container_name: dayz-server-dev
    ports:
      - "2302:2302/udp"
      - "2303:2303/udp"
      - "2302:2302/tcp"
      - "2303:2303/tcp"
    volumes:
      - ./server:/home/dayz/server
      - ./config:/home/dayz/config
      - ./mods:/home/dayz/mods
      - ./logs:/home/dayz/logs
      - ./scripts:/home/dayz/scripts
    environment:
      - DAYZ_PORT=2302
      - DAYZ_STEAM_PORT=2303
      - DAYZ_CPU_CORES=4
    working_dir: /home/dayz
    command: >
      sh -c "
        apt-get update &&
        apt-get install -y wget curl tmux &&
        mkdir -p /home/dayz/steamcmd &&
        cd /home/dayz/steamcmd &&
        curl -sqL 'https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz' | tar zxvf - &&
        /home/dayz/scripts/start-server.sh
      "
    restart: unless-stopped

  # Optional: Monitoring service
  monitoring:
    image: ubuntu:20.04
    container_name: dayz-monitoring
    depends_on:
      - dayz-server
    volumes:
      - ./logs:/home/dayz/logs:ro
      - ./scripts:/home/dayz/scripts:ro
    working_dir: /home/dayz
    command: >
      sh -c "
        apt-get update &&
        apt-get install -y htop iotop nethogs &&
        echo 'Monitoring container ready. Use: docker exec dayz-monitoring htop'
      "
    stdin_open: true
    tty: true

volumes:
  dayz_data:
    driver: local

networks:
  default:
    name: dayz-network
